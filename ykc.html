<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title data-i18n="ykc_verification_title">YKC Verification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <script src="https://unpkg.com/i18next@21.6.14/dist/umd/i18next.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:#000;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow-x:hidden;}
        .container{display:flex;width:100%;max-width:1200px;height:95vh;background:#1e293b;border-radius:12px;box-shadow:0 0 20px rgba(0,255,255,.1);position:relative;margin:10px 0;}
        .sidebar{width:250px;background:#111827;padding:20px;display:flex;flex-direction:column;transition:transform .3s ease-in-out;}
        .sidebar nav ul{list-style:none;}
        .sidebar nav ul li{padding:15px 10px;border-radius:8px;margin-bottom:10px;cursor:pointer;transition:background .3s;}
        .sidebar nav ul li.active a,.sidebar nav ul li:hover a{background:#00ffff;padding:18px;border-radius:15px;color:#000;text-decoration:none;}
        .sidebar nav ul li a{display:flex;align-items:center;color:inherit;text-decoration:none;width:100%;}
        .sidebar nav ul li .icon{margin-right:10px;font-size:18px;}
        .main-content{flex-grow:1;padding:30px 40px;overflow-y:auto;position:relative;}
        .hamburger{display:none;position:absolute;top:20px;left:20px;background:none;border:none;color:#00ffff;font-size:24px;cursor:pointer;z-index:1000;}
        .ykc-verification-content{max-width:600px;margin:0 auto;background:#111827;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(0,255,255,.1);}
        .ykc-verification-content h2{color:#00ffff;text-align:center;margin-bottom:20px;}
        .ykc-verification-content label{display:block;margin-bottom:8px;font-weight:600;}
        .ykc-verification-content input,
        .ykc-verification-content select{width:100%;padding:12px;margin-bottom:20px;background:#1e293b;border:1px solid #2d3748;border-radius:8px;color:#fff;font-size:16px;}
        .ykc-verification-content button{width:100%;padding:12px;background:#00ffff;color:#000;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
        .ykc-verification-content button:hover{background:#00e5e5;}
        .field-group{position:relative;margin-bottom:20px;}
        .field-group .check{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#00ff00;font-size:18px;display:none;}
        .field-group.approved .check{display:block;}
        .field-group.approved input,
        .field-group.approved select{background:#1a3a1a;border-color:#00ff00;color:#fff;pointer-events:none;}
        .status-msg{margin-top:20px;text-align:center;font-weight:600;}
        .status-approved{color:#00ff00;}
        .status-pending{color:#ffcc00;}
        .status-rejected{color:#ff4d4d;}
        @media (max-width:768px){
            .container{flex-direction:column;height:auto;}
            .sidebar{position:fixed;top:0;left:0;height:100%;transform:translateX(-100%);z-index:999;}
            .sidebar.show{transform:translateX(0);}
            .hamburger{display:block;}
        }
    </style>
</head>
<body>
<div class="container" id="main-container" style="display:none;">
    <button class="hamburger"><i class="fa-solid fa-bars"></i></button>

    <div class="sidebar" id="sidebar">
        <nav>
            <ul>
                <li><a href="dashboard.html"><i class="fa-solid fa-house icon"></i><span data-i18n="home">Home</span></a></li>
                <li class="active"><a href="ykc.html"><i class="fa-solid fa-user icon"></i><span data-i18n="YKC">YKC</span></a></li>
                <li><a href="investment.html"><i class="fa-solid fa-boxes-stacked icon"></i><span data-i18n="packages">Packages</span></a></li>
                <li><a href="deposit.html"><i class="fa-regular fa-credit-card icon"></i><span data-i18n="deposit">Deposit</span></a></li>
                <li><a href="withdraw.html"><i class="fa-regular fa-briefcase icon"></i><span data-i18n="withdraw">Withdraw</span></a></li>
                <li><a href="profile.html"><i class="fa-regular fa-address-card icon"></i><span data-i18n="profile">Profile</span></a></li>
                <li><a href="#" id="logout-link"><i class="fa-solid fa-right-from-bracket icon"></i><span data-i18n="logout">Logout</span></a></li>
            </ul>
        </nav>
        <div class="language-selector">
            <select id="languageSwitcher">
                <option value="en">English</option>
                <option value="fr">Français</option>
                <option value="es">Español</option>
            </select>
        </div>
    </div>

    <main class="ykc-verification-content">
        <!-- This form will be hidden when approved -->
        <form id="ykcForm">
            <h2 data-i18n="ykc_verification">YKC Verification</h2>

            <div class="field-group" id="group-name">
                <label for="full-name" data-i18n="full_name">Full Name</label>
                <input type="text" id="full-name" required>
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-dob">
                <label for="date-of-birth" data-i18n="date_of_birth">Date of Birth</label>
                <input type="date" id="date-of-birth" required>
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-address">
                <label for="address" data-i18n="address">Address</label>
                <input type="text" id="address" required>
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-idtype">
                <label for="id-type" data-i18n="id_type">ID Type</label>
                <select id="id-type" required>
                    <option value="" disabled selected>Select ID Type</option>
                    <option value="passport">Passport</option>
                    <option value="driver_license">Driver's License</option>
                    <option value="national_id">National ID</option>
                </select>
                <i class="fa-solid fa-check check"></i>
            </div>

            <!-- Fancy file input – NO upload -->
            <div class="field-group" id="group-document">
                <label for="id-document" data-i18n="id_document">Upload ID Document (optional, for looks)</label>
                <input type="file" id="id-document" accept=".jpg,.jpeg,.png,.pdf">
                <i class="fa-solid fa-check check"></i>
            </div>

            <button type="submit" data-i18n="submit_verification">Submit Verification</button>
        </form>

        <!-- Status message -->
        <div class="status-msg" id="statusMsg"></div>
    </main>
</div>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

    const app = initializeApp({
        apiKey: "AIzaSyDnEbph9IMZuJ3REbfTsocV-g7APCrE-1w",
        authDomain: "investment-40343.firebaseapp.com",
        projectId: "investment-40343",
        storageBucket: "investment-40343.firebasestorage.app",
        messagingSenderId: "126093031981",
        appId: "1:126093031981:web:fd4ae73c063044693b16a4"
    });

    const auth = getAuth(app);
    const db   = getFirestore(app);
    let currentUser = null;

    /* ---------- i18n ---------- */
    i18next.init({
        lng: 'en',
        resources: { en: { translation: {
            ykc_verification: "YKC Verification",
            full_name: "Full Name", date_of_birth: "Date of Birth", address: "Address",
            id_type: "ID Type", id_document: "Upload ID Document (optional, for looks)",
            submit_verification: "Submit Verification",
            status_approved: "Approved! All fields verified.",
            status_pending: "Pending admin review...",
            status_rejected: "Rejected. Please resubmit."
        }}}
    }, () => document.querySelectorAll('[data-i18n]').forEach(el => el.textContent = i18next.t(el.dataset.i18n)));

    /* ---------- Sidebar ---------- */
    document.querySelector('.hamburger').onclick = () => document.getElementById('sidebar').classList.toggle('show');

    /* ---------- Auth ---------- */
    onAuthStateChanged(auth, user => {
        if (!user) return location.href = 'login.html';
        currentUser = user;
        document.getElementById('main-container').style.display = 'flex';
        loadUserVerification();
    });

    /* ---------- Load & Show Approved State ---------- */
    function loadUserVerification() {
        const q = query(collection(db, 'ykc_verifications'), where('uid', '==', currentUser.uid));
        onSnapshot(q, snap => {
            if (snap.empty) {
                document.getElementById('ykcForm').style.display = 'block';
                document.getElementById('statusMsg').textContent = '';
                return;
            }

            const data = snap.docs[0].data();
            const status = data.status || 'pending';

            const msg = document.getElementById('statusMsg');
            msg.textContent = i18next.t(`status_${status}`);
            msg.className = `status-msg status-${status}`;

            if (status === 'approved') {
                // Fill all fields
                document.getElementById('full-name').value = data.fullName || '';
                document.getElementById('date-of-birth').value = data.dob || '';
                document.getElementById('address').value = data.address || '';
                document.getElementById('id-type').value = data.idType || '';

                // Mark ALL fields as approved (green check + disabled)
                ['name', 'dob', 'address', 'idtype', 'document'].forEach(id => {
                    const group = document.getElementById(`group-${id}`);
                    group.classList.add('approved');
                });

                // Hide the form
                document.getElementById('ykcForm').style.display = 'none';
            } else {
                document.getElementById('ykcForm').style.display = 'block';
            }
        });
    }

    /* ---------- Submit (NO upload) ---------- */
    document.getElementById('ykcForm').onsubmit = async e => {
        e.preventDefault();

        try {
            await addDoc(collection(db, 'ykc_verifications'), {
                uid: currentUser.uid,
                fullName: document.getElementById('full-name').value.trim(),
                dob: document.getElementById('date-of-birth').value,
                address: document.getElementById('address').value.trim(),
                idType: document.getElementById('id-type').value,
                documentURL: "dummy://uploaded.jpg",
                status: 'pending',
                submittedAt: serverTimestamp()
            });

            alert('Submitted! (Document is decorative only)');
            e.target.reset();
        } catch (err) {
            console.error(err);
            alert('Error: ' + err.message);
        }
    };

    /* ---------- Logout ---------- */
    document.getElementById('logout-link').onclick = e => {
        e.preventDefault();
        signOut(auth).then(() => location.href = 'login.html');
    };
</script>
</body>
</html>